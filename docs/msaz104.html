<!DOCTYPE html>
<html>
<head>
<script src="apts.js" type="text/javascript"></script>
</head>
<body onload="aptsLoad();">
<div id="conseils">
  Les stagiaires ont 2 supports de stage : celui du stage msaz900 et celui du stage msaz104.
  Il est conseillé de mettre en avant l'intérêt du support de stage msaz900 et de prendre le temps d'en faire une sorte de synthése avant de se lancer dans l'administration Azure en tant que telle.
  la <a href="https://github.com/renaudwangler/ib/blob/master/extra/AzurePrequel.pptx?raw=true">Présentation d'introduction</a> peut aider à parcourir les grands concepts indispensable en début de formation (elle reste pertinent malgrè la forte évolution du stage az-104 car elle synthétise de grands concepts qui sont, sinon, égrainé au long du stage officiel).
  <h3>En direct du <a href="https://learningdownloadcenter.microsoft.com/" target="_blank">Learning Download Center</a></h3>
  Dans les éléments téléchargeables concernant ce stage, ne pas passer à côté de :
  <ul>
    <li>Le "Course Datasheet" qui contient des relations entre le contenu du stage en salle et les liens MSLearn correspondant.</li>
    <Li>Le fichier "Demonstrations" qui, comme son nom l'indique, contient le déroulé des diverses démonstrations utilisées dans le stage.</li>
    <li>Le fichier "AssessmentGuide" qui comprend des liens afin de créer des formulaires/QCM pour chaque module et de les partager aux stagiaires (aprticulièrement pertinent poru de l'animation distancielle).
    <li>Un changelog de 22 pages très complet.</li>    
  </ul>
  <h3>Timing exemple</h3>
  <ul>
    <li>Jour 1 : Introduction (synthèse msaz900) + modules 1 et 2</li>
    <li>Jour 2 : Modules 3,4 et 5</li>
    <li>Jour 3 : Lab 5, modules 6 et 7</li>
    <li>Jour 4 : Modules 8 et 9</li>
    <li>Jour 5 : Modules 10 et 11</li>
  </ul>
  <h3>Tous les labs</h3>
  Il n'est pas nécessaire d'utiliser des labs goDeploy (y compris pour animation distancielle) avec ce stage.
  Si les stagiaires ont des problèmes à se connecter en RDP à une machine virtuelle, leur expliquer la mise en place d'un Bastion pour se connecter à la machine virtuelle directement depuis le navigateur !
  Lien vers <a href="https://microsoftlearning.github.io/AZ-104-MicrosoftAzureAdministrator/" target="_blank">les labs az-104 sur Github</a>
  (les labs sur Github contiennent désormais des schémas introductifs pour chaque lab).
  Expliquer la procédure de nettoyage consistant à supprimer le Resource Group, souvent plus pertinente que les commandes fournies.
  <h3>Atelier 6</h3>
  Il semblerait que, de manière aléatoire, le "network watcher" pose des problèmes dans certaines régions avec les limitations des Pass azure...  
  Voici un code Powershell permettant de réaliser les test Network Watcher dans tous les cas : 
  <code>$rgName = "az104-06-rg1"
    echo 'getting VMs'' informations.'; $VMs=@();$tests=@();$results=@();Get-AzVM -ResourceGroupName $rgName|ForEach-Object {$vms+=[pscustomobject]@{name=$_.name;location=$_.location;id=$_.id;ip=(Get-AzNetworkInterface -ResourceId ($_.networkprofile.networkInterfaces[0].id)).IpConfigurations[0].PrivateIpAddress}}
    $VMNum=$VMs.count*($VMs.count-1); $i=1; foreach ($vmSource in $VMs) {foreach ($vmDest in $VMs) {if ($vmSource.name -ne $vmDest.name) { Write-Progress -Activity "Launching tests" -Status "$($vmSource.name) to $($vmDest.name)" -PercentComplete ($i/$VMNum*100);$i++;$tests+=[pscustomobject]@{sourceVM=$vmSource.name;destinationVM=$vmDest.name;destinationIP=$vmDest.ip;job=Test-AzNetworkWatcherConnectivity -NetworkWatcher (Get-AzNetworkWatcher|Where-Object -Property Location -eq $vmSource.location) -SourceId $vmSource.id -DestinationAddress $vmDest.ip -DestinationPort 3389 -AsJob}}}}
    $i=1; foreach ($test in $tests) {Write-Progress -Activity "Waiting for results" -Status "$($test.sourceVM) to $($test.destinationVM)" -PercentComplete ($i/$VMNum*100);$i++; While ($test.job.state -notlike 'completed') {Start-Sleep -s 15}; $results+=[pscustomobject]@{sourceVM=$test.sourceVM;targetVM=$test.destinationVM;targetIP=$test.destinationIP;targetPort='3389';result=$test.job.output.connectionStatus;latency=$test.job.output.avglatencyinms}}
    $results|format-table</code>
  S'il est impossible d'ajouter une table de routage à un subnet depuis ladite table (latence d'affichage), essayer de passer par l'édtion du dubnet...  
  Voici un code Powershell pour réaliser le loadBalancer si les vNet tardent à remonter dans l'interface du portail:
  <code>$publicip=New-AzPublicIpAddress -Name 'az104-06-pip4' -ResourceGroupName 'az104-06-rg1' -Location (Get-AzResourceGroup -Name 'az104-06-rg1').location -Sku standard -AllocationMethod static
$frontIp = New-AzLoadBalancerFrontendIpConfig -Name 'frontEnd' -PublicIpAddress $publicIp;$bepool = New-AzLoadBalancerBackendAddressPoolConfig -Name 'az104-06-lb4-be1';$probe = New-AzLoadBalancerProbeConfig -Name 'az104-06-lb4-hp1' -Protocol tcp -Port 80 -IntervalInSeconds 5 -ProbeCount 2;$lbRule = New-AzLoadBalancerRuleConfig -Name 'az104-06-lb4-lbrule1' -Protocol tcp -FrontendPort 80 -BackendPort 80 -IdleTimeoutInMinutes 4 -FrontendIpConfiguration $frontIp -BackendAddressPool $bePool -EnableTcpReset -DisableOutboundSNAT
New-AzLoadBalancer -ResourceGroupName 'az104-06-rg1' -Name 'az104-06-lb4' -Location (Get-AzResourceGroup -Name 'az104-06-rg1').location -Sku Standard -FrontendIpConfiguration $frontIp -BackendAddressPool $bePool -LoadBalancingRule $lbRule -Probe $probe
$bepool = get-AzLoadBalancerBackendAddressPool -ResourceGroupName 'az104-06-rg1' -LoadBalancerName 'az104-06-lb4' -Name 'az104-06-lb4-be1'
$vNet = Get-AzVirtualNetwork -Name 'az104-06-vnet01' -ResourceGroupName 'az104-06-rg1';$ip0 = New-AzLoadBalancerBackendAddressConfig -IpAddress "10.60.0.4" -Name "az104-06-vm0" -VirtualNetworkid $vNet.id;$ip1 = New-AzLoadBalancerBackendAddressConfig -IpAddress "10.60.1.4" -Name "az104-06-vm1" -VirtualNetworkid $vNet.id;$bepool.LoadBalancerBackendAddresses.Add($ip0);$bepool.LoadBalancerBackendAddresses.Add($ip1);Set-AzLoadBalancerBackendAddressPool -InputObject $bepool</code>
  <h3>Module 9</h3>
  Il pourra être pertinent de faire une double-démonstration :
  <ul>
    <li> Créer une Web-App avec un conteneur Docker "nginx" récupéré depuis le Docker Hub</li>
    <li> Créer une instance de conteneur "nginx" récupérée depuis le Docker Hub</li>
  </ul>
  Cela permet de bien montrer la différence entre les deux approches, la gestion applicative complète PAAS de la web-app et le '<i>quasi-Iaas</i>' de l'instance de conteneur.
<div id="Azure"></div>
</div>
</body>
</html>
